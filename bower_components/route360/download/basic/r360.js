/*
 Route360° JavaScript API v0.0.9 (5250530), a JS library for leaflet maps. http://route360.net
 (c) 2014 Henning Hollburg and Daniel Gerber, (c) 2014 Motion Intelligence GmbH
*/
!function(t){function e(){var e=t.r360;o.noConflict=function(){return t.r360=e,this},t.r360=o}var o={version:"v0.0.9"};"object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd?define(o):e(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),o=this,n=function(){},i=function(){return o.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,i.prototype=new n,i}),o.config={serviceUrl:"http://api.route360.net/api_dev/",nominatimUrl:"http://geocode.route360.net/",serviceVersion:"v1",pathSerializer:"compact",maxRoutingTime:3600,bikeSpeed:15,bikeUphill:20,bikeDownhill:-10,walkSpeed:5,walkUphill:10,walkDownhill:0,travelTimes:[300,600,900,1200,1500,1800],travelType:"walk",logging:!1,utm:!0,defaultTravelTimeControlOptions:{travelTimes:[{time:300,color:"#006837",opacity:.1},{time:600,color:"#39B54A",opacity:1},{time:900,color:"#8CC63F",opacity:1},{time:1200,color:"#F7931E",opacity:1},{time:1500,color:"#F15A24",opacity:1},{time:1800,color:"#C1272D",opacity:1}],position:"topright",label:"travel time",initValue:30},routeTypes:[{routeType:"WALK",color:"#558D54",halo:"#558D54"},{routeType:"BIKE",color:"#558D54",halo:"#558D54"},{routeType:"CAR",color:"#558D54",halo:"#558D54"},{routeType:"TRANSFER",color:"#558D54",halo:"#558D54"},{routeType:102,color:"#006837",halo:"#006837"},{routeType:400,color:"#156ab8",halo:"#156ab8"},{routeType:900,color:"red",halo:"red"},{routeType:700,color:"#A3007C",halo:"#A3007C"},{routeType:1e3,color:"blue",halo:"blue"},{routeType:109,color:"#006F35",halo:"#006F35"},{routeType:100,color:"red",halo:"red"},{routeType:1,color:"red",halo:"red"},{routeType:2,color:"blue",halo:"blue"},{routeType:3,color:"yellow",halo:"yellow"},{routeType:0,color:"green",halo:"green"},{routeType:4,color:"orange",halo:"orange"},{routeType:5,color:"red",halo:"red"},{routeType:6,color:"blue",halo:"blue"},{routeType:7,color:"yellow",halo:"yellow"}],defaultPlaceAutoCompleteOptions:{serviceUrl:"http://geocode.route360.net/solr/select?",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},photonPlaceAutoCompleteOptions:{serviceUrl:"https://geocode2.route360.net/photon/api?",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},defaultRadioOptions:{position:"topright"},defaultPolygonLayerOptions:{opacity:.4,strokeWidth:30,tolerance:15,backgroundColor:"black",backgroundOpacity:.5,inverse:!1,animate:!0,animationDuration:1},i18n:{language:"de",departure:{en:"Departure",de:"Abfahrt"},line:{en:"Line",de:"Linie"},arrival:{en:"Arrival",de:"Ankunft"},from:{en:"From",de:"Von"},to:{en:"To",de:"Nach"},travelTime:{en:"Travel time",de:"Reisezeit"},totalTime:{en:"Total time",de:"Gesamtzeit"},distance:{en:"Distance",de:"Distanz"},wait:{en:"Please wait!",de:"Bitte warten!"},elevation:{en:"Elevation",de:"Höhenunterschied"},timeFormat:{en:"a.m.",de:"Uhr"},reset:{en:"Reset input",de:"Eingeben löschen"},reverse:{en:"Switch source and target",de:"Start und Ziel tauschen"},settings:{en:"Switch travel type",de:"Reisemodus wechseln"},noRouteFound:{en:"No route found!",de:"Keine Route gefunden!"},monthNames:{de:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]},dayNames:{de:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},dayNamesMin:{de:["So","Mo","Di","Mi","Do","Fr","Sa"]},get:function(t){var e;return _.each(_.keys(o.config.i18n),function(n){t==n&&(e=o.config.i18n[t][o.config.i18n.language])}),e}}},o.Util={getTimeInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},getHoursAndMinutesInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()},getCurrentDate:function(){var t=new Date,e=t.getFullYear(),o=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return e+""+o+n},getTimeFormat:function(t){var e=o.config.i18n;return"en"==e.language&&t>=43200?"p.m.":e.get("timeFormat")},secondsToHoursAndMinutes:function(t){var e=(t/60).toFixed(0),o=Math.floor(e/60);e-=60*o;var n="";return 0!=o&&(n+=o+"h "),n+=e+"min"},secondsToTimeOfDay:function(t){var e=Math.floor(t/3600),o=Math.floor(t/60)-60*e;return t=t-3600*e-60*o,e+":"+("0"+o).slice(-2)+":"+("0"+t).slice(-2)},generateId:function(t){var e="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return _.each(_.range(t?t:10),function(){e+=o.charAt(Math.floor(Math.random()*o.length))}),e},parseLatLonArray:function(t){for(var e=new Array,o=0;o<t.length;o++)e.push(new L.Point(t[o][0],t[o][1]));return e},routeToLeafletPolylines:function(t,e){e="undefined"!=typeof e?e:{};var o=[];return _.each(t.getSegments(),function(n,i){if("TRANSFER"!=n.getType()){var r={};r.color=_.has(e,"color")?e.color:n.getColor();var a={};a.weight=7,a.color="white",(0==i||i==t.getLength()-1)&&(r.dashArray="1, 8");var s=L.polyline(n.getPoints(),a),l=L.polyline(n.getPoints(),r);o.push([s,l])}}),o},getAddressByCoordinates:function(t,e,n){$.getJSON(o.config.nominatimUrl+"reverse.php?&format=json&lat="+t.lat+"&accept-language="+e+"&lon="+t.lng+"&json_callback=?",n)},formatReverseGeocoding:function(t){var e=[];_.has(t.address,"road")&&e.push(t.address.road),_.has(t.address,"house_number")&&e.push(t.address.house_number);var o=[];_.has(t.address,"postcode")&&o.push(t.address.postcode),_.has(t.address,"city")&&o.push(t.address.city);var n=[];return e.length>0&&n.push(e.join(" ")),o.length>0&&n.push(o.join(", ")),0==e.length&&0==o.length&&n.push(t.display_name),n.join(", ")},parsePolygons:function(t){if(t.error)return errorMessage;if(o.config.logging)var e=(new Date).getTime();var n=Array();return _.each(t,function(t){var e={id:t.id,polygons:[]};_.each(t.polygons,function(t){var n=o.polygon();n.setTravelTime(t.travelTime),n.setArea(t.area);var i=_.findWhere(o.config.defaultTravelTimeControlOptions.travelTimes,{time:n.getTravelTime()});n.setColor("undefined"!=typeof i?i.color:"#000000");var r=_.findWhere(o.config.defaultTravelTimeControlOptions.travelTimes,{time:n.getTravelTime()});n.setOpacity("undefined"!=typeof r?r.opacity:1),n.setOuterBoundary(o.Util.parseLatLonArray(t.outerBoundary)),n.setBoundingBox(),_.each(t.innerBoundary,function(t){n.addInnerBoundary(o.Util.parseLatLonArray(t))}),e.polygons.push(n)}),n.push(e)}),o.config.logging&&console.log("Polygon parsing took: "+((new Date).getTime()-e)+"ms"),n},parseRoutes:function(t){var e=new Array;return _.each(t.routes,function(t){e.push(o.route(t.travelTime,t.segments))}),e},getMarker:function(t,e){var o=_.has(e,"color")?"-"+e.color:"-blue";return e.icon=L.icon({iconSize:[25,41],iconUrl:e.iconPath+"marker-icon"+o+".png",iconAnchor:[12,41],shadowSize:[41,41],shadowUrl:e.iconPath+"marker-shadow.png",shadowAnchor:[41/3,41],popupAnchor:[0,-35]}),L.marker(t,e)},webMercatorToLeaflet:function(t){return t.x/=6378137,t.y/=6378137,L.CRS.EPSG3857.transformation._transform(t),t},webMercatorToLatLng:function(t,e){var o=L.CRS.EPSG3857.projection.unproject(new L.Point(t.x/=6378137,t.y/=6378137));return"undefined"!=typeof e?L.latLng([o.lat,o.lng,e]):o},latLngToWebMercator:function(t){var e=L.Projection.SphericalMercator.project(t);return e.x*=6378137,e.y*=6378137,e}},o.TravelOptions=function(){this.sources=[],this.targets=[],this.service,this.bikeSpeed=15,this.bikeUphill=20,this.bikeDownhill=-10,this.walkSpeed=5,this.walkUphill=10,this.walkDownhill=0,this.minPolygonHoleSize=1e6,this.supportWatts=0,this.renderWatts=!1,this.travelTimes=[300,600,900,1200,1500,1800],this.travelType="walk",this.elevationEnabled=!0,this.time=o.Util.getTimeInSeconds(),this.date=o.Util.getCurrentDate(),this.errors=[],this.intersectionMode="union",this.pathSerializer=o.config.pathSerializer,this.maxRoutingTime=o.config.maxRoutingTime,this.waitControl,this.isValidPolygonServiceOptions=function(){return this.errors=[],"[object Array]"===Object.prototype.toString.call(this.getSources())?0==this.getSources().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getSources(),function(t){_.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined latitude!"),_.has(t,"lon")||_.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined longitude!")}):this.getErrors().push("Sources are not of type array!"),_.contains(["bike","transit","walk","car"],this.getTravelType())?"car"==this.getTravelType()||("bike"==this.getTravelType()?((this.getBikeUphill()<0||this.getBikeDownhill()>0||this.getBikeUphill()<-this.getBikeDownhill())&&this.getErrors().push("Uphill cycle speed has to be larger then 0. Downhill cycle speed has to be smaller then 0.                         Absolute value of downhill cycle speed needs to be smaller then uphill cycle speed."),this.getBikeSpeed()<=0&&this.getErrors().push("Bike speed needs to be larger then 0.")):"walk"==this.getTravelType()?((this.getWalkUphill()<0||this.getWalkDownhill()>0||this.getWalkUphill()<-this.getWalkDownhill())&&this.getErrors().push("Uphill walking speed has to be larger then 0. Downhill walking speed has to be smaller then 0.                         Absolute value of downhill walking speed needs to be smaller then uphill walking speed."),this.getWalkSpeed()<=0&&this.getErrors().push("Walk speed needs to be larger then 0.")):"transit"==this.getTravelType()&&(this.getTime()<0&&this.getErrors().push("Start time for transit routing needs to larger than 0: "+this.getTime()),8!=this.getDate().length&&this.getErrors().push("Date has to have format YYYYMMDD: "+this.getDate()))):this.getErrors().push("Not supported travel type given: "+this.getTravelType()),"[object Array]"!==Object.prototype.toString.call(this.getTravelTimes())?this.getErrors().push("Travel times have to be an array!"):_.reject(this.getTravelTimes(),function(t){return"number"==typeof t}).length>0&&this.getErrors().push("Travel times contain non number entries: "+this.getTravelTimes()),_.contains(["union","average","intersection","none"],this.getIntersectionMode())||this.getErrors().push("Not supported intersection mode given: "+this.getIntersectionMode()),0==this.errors.length},this.isValidRouteServiceOptions=function(){return this.isValidPolygonServiceOptions(),"[object Array]"===Object.prototype.toString.call(this.getTargets())?0==this.getTargets().length?this.getErrors().push("Sources do not contain any points!"):_.each(this.getTargets(),function(t){_.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined latitude!"),_.has(t,"lon")||_.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined longitude!")}):this.getErrors().push("Targets are not of type array!"),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.isValidTimeServiceOptions=function(){return this.isValidRouteServiceOptions(),_.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.getErrors=function(){return this.errors},this.getSources=function(){return this.sources},this.addSource=function(t){this.sources.push(t)},this.addTarget=function(t){this.targets.push(t)},this.getTargets=function(){return this.targets},this.getBikeSpeed=function(){return this.bikeSpeed},this.getBikeUphill=function(){return this.bikeUphill},this.getBikeDownhill=function(){return this.bikeDownhill},this.getWalkSpeed=function(){return this.walkSpeed},this.getWalkUphill=function(){return this.walkUphill},this.getWalkDownhill=function(){return this.walkDownhill},this.getTravelTimes=function(){return this.travelTimes},this.getTravelType=function(){return this.travelType},this.getTime=function(){return this.time},this.getDate=function(){return this.date},this.getWaitControl=function(){return this.waitControl},this.getService=function(){return this.service},this.getPathSerializer=function(){return this.pathSerializer},this.getMaxRoutingTime=function(){return this.maxRoutingTime},this.getIntersectionMode=function(){return this.intersectionMode},this.setIntersectionMode=function(t){this.intersectionMode=t},this.setMaxRoutingTime=function(t){this.maxRoutingTime=t},this.setPathSerializer=function(t){this.pathSerializer=t},this.setService=function(t){this.service=t},this.setMinPolygonHoleSize=function(t){this.minPolygonHoleSize=t},this.getMinPolygonHoleSize=function(){return this.minPolygonHoleSize},this.setSources=function(t){this.sources=t},this.setTargets=function(t){this.targets=t},this.setBikeSpeed=function(t){this.bikeSpeed=t},this.setBikeUphill=function(t){this.bikeUphill=t},this.setBikeDownhill=function(t){this.bikeDownhill=t},this.setWalkSpeed=function(t){this.walkSpeed=t},this.setWalkUphill=function(t){this.walkUphill=t},this.setWalkDownhill=function(t){this.walkDownhill=t},this.setTravelTimes=function(t){this.travelTimes=t},this.setTravelType=function(t){this.travelType=t},this.setTime=function(t){this.time=t},this.setDate=function(t){this.date=t},this.setWaitControl=function(t){this.waitControl=t},this.isElevationEnabled=function(){return this.elevationEnabled},this.setElevationEnabled=function(t){this.elevationEnabled=t},this.setRenderingMode=function(t){"watts"==t&&(this.renderWatts=!0)},this.getRenderingMode=function(){return this.renderWatts},this.setSupportWatts=function(t){this.supportWatts=t},this.getSupportWatts=function(){return this.supportWatts}},o.travelOptions=function(){return new o.TravelOptions},o.PolygonService={cache:{},getTravelTimePolygons:function(t,e){if(t.isValidPolygonServiceOptions()){t.getWaitControl()&&t.getWaitControl().show();var n={elevation:t.isElevationEnabled(),polygon:{values:t.getTravelTimes(),intersectionMode:t.getIntersectionMode(),renderWatts:t.getRenderingMode(),supportWatts:t.getSupportWatts()},sources:[]};_.each(t.getSources(),function(e){var o={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:e.lat+";"+e.lng,tm:{}},i=_.has(e,"travelType")?e.travelType:t.getTravelType();o.tm[i]={},"transit"==i&&(o.tm.transit.frame={time:t.getTime(),date:t.getDate()}),"bike"==i&&(o.tm.bike={speed:t.getBikeSpeed(),uphill:t.getBikeUphill(),downhill:t.getBikeDownhill()}),"walk"==i&&(o.tm.walk={speed:t.getWalkSpeed(),uphill:t.getWalkUphill(),downhill:t.getWalkDownhill()}),n.sources.push(o)}),_.has(o.PolygonService.cache,JSON.stringify(n))?(t.getWaitControl()&&t.getWaitControl().hide(),e(o.Util.parsePolygons(o.PolygonService.cache[JSON.stringify(n)]))):$.getJSON(o.config.serviceUrl+o.config.serviceVersion+"/polygon?cfg="+encodeURIComponent(JSON.stringify(n))+"&cb=?&key="+o.config.serviceKey,function(i){o.PolygonService.cache[JSON.stringify(n)]=i,t.getWaitControl()&&t.getWaitControl().hide(),e(o.Util.parsePolygons(i))})}else alert("Travel options are not valid!"),console.log(t.getErrors())}},o.RouteService={cache:{},getRoutes:function(t,e){if(t.isValidRouteServiceOptions()){t.getWaitControl()&&t.getWaitControl().show();var n={sources:[],targets:[],pathSerializer:t.getPathSerializer(),elevation:t.isElevationEnabled()};_.each(t.getSources(),function(e){var o={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:e.lat+";"+e.lng,tm:{}},i=_.has(e,"travelType")?e.travelType:t.getTravelType();o.tm[i]={},"transit"==i&&(o.tm.transit.frame={time:t.getTime(),date:t.getDate()}),"bike"==i&&(o.tm.bike={speed:t.getBikeSpeed(),uphill:t.getBikeUphill(),downhill:t.getBikeDownhill()}),"walk"==i&&(o.tm.walk={speed:t.getWalkSpeed(),uphill:t.getWalkUphill(),downhill:t.getWalkDownhill()}),n.sources.push(o)}),n.targets=[],_.each(t.getTargets(),function(t){n.targets.push({lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:t.lat+";"+t.lng})}),_.has(o.RouteService.cache,JSON.stringify(n))?(t.getWaitControl()&&t.getWaitControl().hide(),e(o.Util.parseRoutes(o.RouteService.cache[JSON.stringify(n)]))):$.getJSON(o.config.serviceUrl+o.config.serviceVersion+"/route?cfg="+encodeURIComponent(JSON.stringify(n))+"&cb=?&key="+o.config.serviceKey,function(i){o.RouteService.cache[JSON.stringify(n)]=i,t.getWaitControl()&&t.getWaitControl().hide(),e(o.Util.parseRoutes(i))})}else alert("Travel options are not valid!"),console.log(t.getErrors())}},o.TimeService={cache:{},getRouteTime:function(t,e){if(t.isValidTimeServiceOptions()){t.getWaitControl()&&t.getWaitControl().show();var n={sources:[],targets:[],pathSerializer:t.getPathSerializer(),maxRoutingTime:t.getMaxRoutingTime()};_.each(t.getSources(),function(e){console.log(e);var o={lat:_.has(e,"lat")?e.lat:e.getLatLng().lat,lng:_.has(e,"lon")?e.lon:_.has(e,"lng")?e.lng:e.getLatLng().lng,id:_.has(e,"id")?e.id:e.lat+";"+e.lon,tm:{}},i=_.has(e,"travelType")?e.travelType:t.getTravelType();o.tm[i]={},"transit"==i&&(o.tm.transit.frame={time:t.getTime(),date:t.getDate()}),"bike"==i&&(o.tm.bike={speed:t.getBikeSpeed(),uphill:t.getBikeUphill(),downhill:t.getBikeDownhill()}),"walk"==i&&(o.tm.walk={speed:t.getWalkSpeed(),uphill:t.getWalkUphill(),downhill:t.getWalkDownhill()}),n.sources.push(o)}),_.each(t.getTargets(),function(t){n.targets.push({lat:_.has(t,"lat")?t.lat:t.getLatLng().lat,lng:_.has(t,"lon")?t.lon:_.has(t,"lng")?t.lng:t.getLatLng().lng,id:_.has(t,"id")?t.id:t.lat+";"+t.lon})}),_.has(o.TimeService.cache,JSON.stringify(n))?(t.getWaitControl()&&t.getWaitControl().hide(),e(o.TimeService.cache[JSON.stringify(n)])):$.ajax({url:o.config.serviceUrl+o.config.serviceVersion+"/time?key="+o.config.serviceKey,type:"POST",data:JSON.stringify(n),contentType:"application/json",dataType:"json",success:function(i){o.TimeService.cache[JSON.stringify(n)]=i,t.getWaitControl()&&t.getWaitControl().hide(),e(i)},error:function(t,e,o){console.log(t.status),console.log(o)}})}else alert("Travel options are not valid!"),console.log(t.getErrors())}},o.placeAutoCompleteControl=function(t){return new o.PlaceAutoCompleteControl(t)},o.PlaceAutoCompleteControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(o.config.defaultPlaceAutoCompleteOptions)),"undefined"!=typeof t&&(_.has(t,"position")&&(this.options.position=t.position),_.has(t,"label")&&(this.options.label=t.label),_.has(t,"country")&&(this.options.country=t.country),_.has(t,"reset")&&(this.options.reset=t.reset),_.has(t,"reverse")&&(this.options.reverse=t.reverse),_.has(t,"placeholder")&&(this.options.placeholder=t.placeholder),_.has(t,"width")&&(this.options.width=t.width),_.has(t,"maxRows")&&(this.options.maxRows=t.maxRows),_.has(t,"image")&&(this.options.image=t.image),_.has(t,"index")&&(this.options.index=t.index),_.has(t,"options")&&(this.options.options=t.options,this.options.travelType=_.has(this.options.options,"init")?this.options.options.init:"walk"))},onAdd:function(t){var e=this,n=o.config.i18n,i="",r=L.DomUtil.create("div",e._container);e.options.map=t,e.options.id=$(t._container).attr("id")+o.Util.generateId(10),t.on("resize",e.onResize.bind(e));var a=e.options.width,s='style="width:'+a+'px;"';e.options.input='<div class="input-group autocomplete" '+s+'>                 <input id="autocomplete-'+e.options.id+'" style="color: black;width:'+a+'"                 type="text" class="form-control r360-autocomplete" placeholder="'+e.options.placeholder+'" onclick="this.select()">',e.options.image&&(e.options.input+='<span id="'+e.options.id+'-image" class="input-group-addon btn-autocomplete-marker">                     <img style="height:22px;" src="'+e.options.image+'">                  </span>');var l=[];return e.options.input+='<span id="'+e.options.id+'-options-button" class="input-group-btn travel-type-buttons" '+(e.options.options?"":'style="display: none;"')+'>                     <button class="btn btn-autocomplete" type="button" title="'+n.get("settings")+'"><i class="fa fa-cog fa-fw"></i></button>                 </span>',l.push('<div id="'+e.options.id+'-options" class="text-center" style="color: black;width:'+a+'; display: none;">'),l.push('  <div class="btn-group text-center">'),e.options.options&&e.options.options.walk&&l.push('<button type="button" class="btn btn-default travel-type-button '+("walk"==this.options.travelType?"active":"")+'" travel-type="walk"><span class="map-icon-walking travel-type-icon"></span> <span lang="en">Walk</span><span lang="de">zu Fuß</span></button>'),e.options.options&&e.options.options.bike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("bike"==this.options.travelType?"active":"")+'" travel-type="bike"><span class="map-icon-bicycling travel-type-icon"></span> <span lang="en">Bike</span><span lang="de">Fahrrad</span></button>'),e.options.options&&e.options.options.hirebike&&l.push('<button type="button" class="btn btn-default travel-type-button '+("hirebike"==this.options.travelType?"active":"")+'" travel-type="hirebike">                             <span class="map-icon-bicycling travel-type-icon"></span> <span lang="en">Hire Bike</span><span lang="de">Leihfahrrad</span>                        </button>'),e.options.options&&e.options.options.transit&&l.push('<button type="button" class="btn btn-default travel-type-button '+("transit"==this.options.travelType?"active":"")+'" travel-type="transit"><span class="map-icon-train-station travel-type-icon"></span> <span lang="en">Transit</span><span lang="de">ÖPNV</span></button>'),e.options.options&&e.options.options.car&&l.push('<button type="button" class="btn btn-default travel-type-button '+("car"==this.options.travelType?"active":"")+'" travel-type="car"><span class="fa fa-car"></span> <span lang="en">Car</span><span lang="de">Auto</span></button>'),l.push("  </div>"),l.push("</div>"),e.options.input+='<span id="'+e.options.id+'-reverse" '+(e.options.reverse?"":'style="display: none;"')+'" class="input-group-btn">                     <button class="btn btn-autocomplete" type="button" title="'+n.get("reverse")+'"><i class="fa fa-arrows-v fa-fw"></i></button>                 </span>',e.options.input+='<span id="'+e.options.id+'-reset" '+(e.options.reset?"":'style="display: none;"')+'" class="input-group-btn">                     <button class="btn btn-autocomplete" type="button" title="'+n.get("reset")+'"><i class="fa fa-times fa-fw"></i></button>                 </span>',e.options.input+="</div>",e.options.options&&(e.options.input+=l.join("")),$(r).append(e.options.input),$(r).find("#"+e.options.id+"-reset").click(function(){e.options.onReset()}),$(r).find("#"+e.options.id+"-reverse").click(function(){e.options.onReverse()}),$(r).find("#"+e.options.id+"-options-button").click(function(){$("#"+e.options.id+"-options").slideToggle()}),$(r).find(".travel-type-button").click(function(){$(r).find(".travel-type-button").removeClass("active"),$(this).addClass("active"),setTimeout(function(){$("#"+e.options.id+"-options").slideToggle()},300),e.options.travelType=$(this).attr("travel-type"),e.options.onTravelTypeChange()}),L.DomEvent.disableClickPropagation(r),_.has(e.options,"country")&&(i+=" AND country:"+e.options.country),$(r).find("#autocomplete-"+e.options.id).autocomplete({source:function(t,o){e.source=this;for(var n=t.term.split(" "),r=new Array,a="",s="",l=0;l<n.length;l++)-1!=n[l].search(".*[0-9].*")?r.push(n[l]):a+=n[l]+" ";if(r.length>0){s+=" OR ";for(var p=0;p<r.length;p++){var u="(postcode : "+r[p]+" OR housenumber : "+r[p]+" OR street : "+r[p]+") ";s+=u}}$.ajax({url:e.options.serviceUrl,dataType:"jsonp",jsonp:"json.wrf",async:!1,data:{wt:"json",indent:!0,rows:e.options.maxRows,qt:"en",q:"("+a+s+")"+i},success:function(n){var i=new Array;o($.map(n.response.docs,function(o){if("boundary"!=o.osm_key){var n=o.coordinate.split(","),r={},a=[],s=[];if(r.name=o.name,r.city=o.city,r.street=o.street,r.housenumber=o.housenumber,r.country=o.country,r.postalCode=o.postcode,r.name&&a.push(r.name),r.city&&a.push(r.city),r.street&&s.push(r.street),r.housenumber&&s.push(r.housenumber),r.postalCode&&s.push(r.postalCode),r.city&&s.push(r.city),!_.has(e.options,"country")&&r.country&&s.push(r.country),!_.contains(i,a.join()+s.join()))return i.push(a.join()+s.join()),{label:a.join(", "),value:a.join(", "),firstRow:a.join(", "),secondRow:s.join(" "),term:t.term,index:e.options.index,latlng:new L.LatLng(n[0],n[1])}}}))}})},minLength:2,select:function(t,o){e.options.value=o.item,e.options.onSelect(o.item)}}).data("ui-autocomplete")._renderItem=function(t,e){function o(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n=e.term?e.firstRow.replace(new RegExp(o(e.term),"gi"),"<strong>$&</strong>"):e.firstRow,i=e.term?e.secondRow.replace(new RegExp(o(e.term),"gi"),"<strong>$&</strong>"):e.secondRow,r="<a><span class='address-row1'>"+n+"</span><br/><span class='address-row2'>  "+i+"</span></a>";return $("<li>").append(r).appendTo(t)},this.onResize(),r},onSelect:function(t){this.options.onSelect=t},onReset:function(t){this.options.onReset=t},onReverse:function(t){this.options.onReverse=t},onTravelTypeChange:function(t){this.options.onTravelTypeChange=t},reset:function(){this.options.value={},this.setFieldValue("")},update:function(t,e){this.setLatLng(t),this.setFieldValue(e)},setLatLng:function(t){this.options.value.latlng=t},setFieldValue:function(t){var e=this;$("#autocomplete-"+e.options.id).val(t)},getFieldValue:function(){var t=this;return $("#autocomplete-"+t.options.id).val()},getTravelType:function(){return this.options.travelType},setValue:function(t){this.options.value=t},getValue:function(){return this.options.value},getIndex:function(){return this.options.index},onResize:function(){var t=this;$(t.options.input).css(this.options.map.getSize().x<550?{width:"45px"}:{width:""})}}),o.TravelStartDateControl=L.Control.extend({options:{position:"topright",dateFormat:"yy-mm-dd",minDate:0},initialize:function(t){L.Util.setOptions(this,t)},onChange:function(t){this.options.onChange=t},onAdd:function(t){var e=this;e.options.map=t;var n=L.DomUtil.create("div","startDatePicker",this._container);e.datepicker=$("<div/>"),$(n).append(e.datepicker);var i={onSelect:function(){e.options.onChange(e.getValue())},firstDay:1},r=o.config.i18n;return"en"!=r.language&&(i.monthNames=r.monthNames[r.language],i.dayNames=r.dayNames[r.language],i.dayNamesMin=r.dayNamesMin[r.language]),$(e.datepicker).datepicker(i),L.DomEvent.disableClickPropagation(n),n},getValue:function(){var t=this,e=$(t.datepicker).datepicker({dateFormat:"dd-mm-yy"}).val(),o=e.split("/"),n=o[2]+""+o[0]+o[1];return n}}),o.travelStartDateControl=function(){return new o.TravelStartDateControl},o.TravelStartTimeControl=L.Control.extend({options:{position:"topright",range:!1,min:0,max:86400,step:600,initValue:28800,value:0},initialize:function(t){this.options.value=o.Util.getHoursAndMinutesInSeconds(),L.Util.setOptions(this,t)},onSlideStop:function(t){this.options.slideStop=t},minToString:function(t){t/=60;var e=Math.floor(t/60),o=t-60*e;return e>24&&(e-=24),10>e&&(e="0"+e),10>o&&(o="0"+o),0==o&&(o="00"),e+":"+o},onAdd:function(t){var e=this;e.options.map=t,e.options.mapId=$(t._container).attr("id"),t.on("resize",this.onResize.bind(this));var n=L.DomUtil.create("div","startTimeSlider",this._container);return e.miBox=$("<div/>",{"class":"mi-box"}),e.startTimeInfo=$("<div/>"),e.label=$("<span/>"),e.slider=$("<div/>"),$(n).append(e.miBox.append(e.startTimeInfo.append(e.label)).append(e.slider)),$(e.label).text(o.config.i18n.get("departure")+": "+e.minToString(this.options.value)+" "+o.Util.getTimeFormat(e.options.value)),$(e.slider).slider({range:e.options.range,value:e.options.value,min:e.options.min,max:e.options.max,step:e.options.step,slide:function(t,n){$(e.label).text(o.config.i18n.get("departure")+": "+e.minToString(n.value)+" "+o.Util.getTimeFormat(n.value)),e.options.value=n.value},stop:function(t,o){e.options.slideStop(o.value)}}),this.onResize(),L.DomEvent.disableClickPropagation(n),n},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.startTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.slider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(t,e,o){$(t).addClass(o),$(t).removeClass(e)},getValue:function(){return this.options.value}}),o.travelStartTimeControl=function(){return new o.TravelStartTimeControl},o.TravelTimeControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(o.config.defaultTravelTimeControlOptions)),"undefined"!=typeof t&&(_.has(t,"position")&&(this.options.position=t.position),_.has(t,"initValue")&&(this.options.initValue=t.initValue),_.has(t,"label")&&(this.options.label=t.label),_.has(t,"travelTimes")&&(this.options.travelTimes=t.travelTimes),_.has(t,"icon")&&(this.options.icon=t.icon)),this.options.maxValue=_.max(this.options.travelTimes,function(t){return t.time}).time/60,this.options.step=(this.options.travelTimes[1].time-this.options.travelTimes[0].time)/60},onAdd:function(t){var e=this;this.options.map=t,t.on("resize",this.onResize.bind(this));for(var o="",n=100/this.options.travelTimes.length,i=0;i<this.options.travelTimes.length;i++)0==i?o+='<div style="position: absolute; top: 0; bottom: 0; left: '+i*n+"%; right: "+(100-(i+1)*n)+"%; background-color: "+this.options.travelTimes[i].color+'; -moz-border-top-left-radius: 8px;-webkit-border-radius-topleft: 8px; border-top-left-radius: 8px; -moz-border-bottom-left-radius: 8px;-webkit-border-radius-bottomleft: 8px; border-bottom-left-radius: 8px;"></div>':i<this.options.travelTimes.length-1?o+='<div style="position: absolute; top: 0; bottom: 0; left: '+i*n+"%; right: "+(100-(i+1)*n)+"%; background-color: "+this.options.travelTimes[i].color+';"></div>':i==this.options.travelTimes.length-1&&(o+='<div style="position: absolute; top: 0; bottom: 0; left: '+i*n+"%; right: "+(100-(i+1)*n)+"%; background-color: "+this.options.travelTimes[i].color+'; -moz-border-top-right-radius: 8px;-webkit-border-radius-topright: 8px; border-top-right-radius: 8px; -moz-border-bottom-right-radius: 8px;-webkit-border-radius-bottomright: 8px; border-bottom-right-radius: 8px;"></div>');this.options.sliderContainer=L.DomUtil.create("div",this._container),this.options.miBox=$("<div/>",{"class":"mi-box"}),this.options.travelTimeInfo=$("<div/>"),this.options.travelTimeSlider=$("<div/>",{"class":"no-border"}).append(o);var r=$("<div/>",{"class":"ui-slider-handle"});this.options.labelSpan='<span lang="en">Traveltime</span><span lang="de">Reisezeit</span>: ',"undefined"!=this.options.icon&&(this.options.iconHTML=$("<img/>",{src:this.options.icon})),this.options.travelTimeSpan=$("<span/>",{text:this.options.initValue});var a=$("<span/>",{text:"min"});return $(this.options.sliderContainer).append(this.options.miBox),this.options.miBox.append(this.options.travelTimeInfo),this.options.miBox.append(this.options.travelTimeSlider),this.options.travelTimeSlider.append(r),this.options.travelTimeInfo.append(this.options.iconHTML).append(this.options.labelSpan).append(this.options.travelTimeSpan).append(a),$(this.options.travelTimeSlider).slider({range:!1,value:e.options.initValue,min:0,max:e.options.maxValue,step:e.options.step,slide:function(t,o){return 0==o.value?!1:void $(e.options.travelTimeSpan).text(o.value)
},stop:function(t,o){for(var n=new Array,i=0;i<o.value;i+=e.options.step)n.push(e.options.travelTimes[i/e.options.step]);e.options.onSlideStop(n)}}),this.onResize(),L.DomEvent.disableClickPropagation(this.options.sliderContainer),this.options.sliderContainer},onResize:function(){this.options.map.getSize().x<550?(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-max","leaflet-traveltime-slider-container-min"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-max","travel-time-info-min"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-max","leaflet-traveltime-slider-min")):(this.removeAndAddClass(this.options.miBox,"leaflet-traveltime-slider-container-min","leaflet-traveltime-slider-container-max"),this.removeAndAddClass(this.options.travelTimeInfo,"travel-time-info-min","travel-time-info-max"),this.removeAndAddClass(this.options.travelTimeSlider,"leaflet-traveltime-slider-min","leaflet-traveltime-slider-max"))},removeAndAddClass:function(t,e,o){$(t).addClass(o),$(t).removeClass(e)},onSlideStop:function(t){var e=this.options;e.onSlideStop=t},setValue:function(t){$(this.options.travelTimeSlider).slider("value",t),$(this.options.travelTimeSpan).text(t)},getValues:function(){for(var t=this.options,e=new Array,o=0;o<$(this.options.travelTimeSlider).slider("value");o+=t.step)e.push(t.travelTimes[o/t.step].time);return e},getMaxValue:function(){return _.max(this.getValues())}}),o.travelTimeControl=function(t){return new o.TravelTimeControl(t)},o.waitControl=function(t){return new L.Control.WaitControl(t)},L.Control.WaitControl=L.Control.extend({options:{position:"topleft"},initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){this.options.map=t,this.options.mapId=$(t._container).attr("id");var e=L.DomUtil.create("div","leaflet-control-wait");return $(e).append('<div id="wait-control-'+this.options.mapId+'" class="mi-box waitControl">                 <i class="fa fa-spinner fa-spin"></i> '+o.config.i18n.get("wait")+"            </div>"),e},show:function(){$("#wait-control-"+this.options.mapId).show()},hide:function(){$("#wait-control-"+this.options.mapId).hide()}}),o.htmlControl=function(t){return new L.Control.HtmlControl(t)},L.Control.HtmlControl=L.Control.extend({options:{position:"topleft"},initialize:function(t){L.Util.setOptions(this,t)},onAdd:function(t){this.options.id=$(t._container).attr("id")+o.Util.generateId();var e=L.DomUtil.create("div","leaflet-control-html");return $(e).append('<div id="html-control-'+this.options.id+'" class="html-control '+this.options.classes+'"></div>'),$(e).on("mouseover",function(){t.scrollWheelZoom.disable()}),$(e).on("mouseout",function(){t.scrollWheelZoom.enable()}),e},setHtml:function(t){$("#html-control-"+this.options.id).html(t)},show:function(){$("#html-control-"+this.options.id).show()},hide:function(){$("#html-control-"+this.options.id).hide()},toggle:function(){$("#html-control-"+this.options.id).toggle()}}),o.RadioButtonControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(o.config.defaultRadioOptions)),"undefined"!=typeof t&&("undefined"!=typeof t.position&&(this.options.position=t.position),"undefined"!=typeof t.buttons?this.options.buttons=t.buttons:alert("No buttons supplied!"))},onAdd:function(t){var e=this;this.options.map=t;var o=L.DomUtil.create("div",this._container);return this.options.input=this.getRadioButtonHTML(),$(o).append(this.options.input),$(this.options.input).buttonset({}).change(function(){e.options.checked=$("input[name='r360_radiobuttongroup_"+e.options.buttonGroupId+"']:checked").attr("key"),e.options.onChange(e.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({position:{my:"center top+10",at:"center bottom",using:function(t,e){$(this).css(t),$("<div>").addClass("arrow top").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(o,"click",L.DomEvent.stopPropagation),o},onChange:function(t){this.options.onChange=t},getValue:function(){return this.options.checked},getRadioButtonHTML:function(){var t=this;t.options.buttonGroupId=o.Util.generateId(5);var e=$("<div/>",{id:t.options.buttonGroupId});return _.each(t.options.buttons,function(n){var i=o.Util.generateId(),r=$("<input/>",{type:"radio",id:"r360_"+i,value:n.key,key:n.key,name:"r360_radiobuttongroup_"+t.options.buttonGroupId}),a=$("<label/>",{"for":"r360_"+i,html:n.label});n.checked&&(t.options.checked=n.key,r.attr({checked:"checked"})),"undefined"!=typeof n.tooltip&&a.attr({title:n.tooltip}),e.append(r),e.append(a)}),e}}),o.radioButtonControl=function(t){return new o.RadioButtonControl(t)},o.CheckboxButtonControl=L.Control.extend({initialize:function(t){this.options=JSON.parse(JSON.stringify(o.config.defaultRadioOptions)),this.options.checked={},"undefined"!=typeof t&&("undefined"!=typeof t.position&&(this.options.position=t.position),"undefined"!=typeof t.buttons?this.options.buttons=t.buttons:alert("No buttons supplied!"))},onAdd:function(t){var e=this;this.options.map=t;var o=L.DomUtil.create("div",this._container);return this.options.input=this.getCheckboxButtonHTML(),$(o).append(this.options.input),$(this.options.input).buttonset({}).change(function(){$("input:checkbox[name='r360_checkboxbuttongroup_"+e.options.buttonGroupId+"']").each(function(){e.options.checked[$(this).attr("key")]=$(this).is(":checked")?!0:!1}),e.options.onChange(e.options.checked)}),$(this.options.input).each(function(){$(this).tooltip({position:{my:"center top+10",at:"center bottom",using:function(t,e){$(this).css(t),$("<div>").addClass("arrow top").addClass(e.vertical).addClass(e.horizontal).appendTo(this)}}})}),L.DomEvent.addListener(o,"click",L.DomEvent.stopPropagation),o},onChange:function(t){this.options.onChange=t},getValue:function(){return this.options.checked},getCheckboxButtonHTML:function(){var t=this;t.options.buttonGroupId=o.Util.generateId(5);var e=$("<div/>",{id:t.options.buttonGroupId});return _.each(t.options.buttons,function(n){var i=o.Util.generateId(),r=$("<input/>",{type:"checkbox",id:"r360_"+i,value:n.key,key:n.key,name:"r360_checkboxbuttongroup_"+t.options.buttonGroupId}),a=$("<label/>",{"for":"r360_"+i,html:n.label});n.checked&&(t.options.checked[n.key]=!0,r.attr({checked:"checked"})),"undefined"!=typeof n.tooltip&&a.attr({title:n.tooltip}),e.append(r),e.append(a)}),e}}),o.checkboxButtonControl=function(t){return new o.CheckboxButtonControl(t)},o.Polygon=function(t,e,n){var i=this;i.topRight=new L.latLng(-90,-180),i.bottomLeft=new L.latLng(90,180),i.centerPoint=new L.latLng(0,0),i.travelTime=t,i.area=e,i.color,i.outerBoundary=n,i.innerBoundaries=new Array,i.innerProjectedBoundaries=new Array,i.setOuterBoundary=function(t){i.outerBoundary=t},i.projectOuterBoundary=function(){i.outerProjectedBoundary=new Array;for(var t=0;t<i.outerBoundary.length;t++)i.outerProjectedBoundary.push(o.Util.webMercatorToLeaflet(i.outerBoundary[t]))},i.project=function(){i.projectOuterBoundary()},i.addInnerBoundary=function(t){var e={};e.projectedBottomLeft=new L.Point(20026377,20048967),e.projectedTopRight=new L.Point(-20026377,-20048967);for(var n=t.length-1;n>=0;n--)t[n].x>e.projectedTopRight.x&&(e.projectedTopRight.x=t[n].x),t[n].x<e.projectedBottomLeft.x&&(e.projectedBottomLeft.x=t[n].x),t[n].y>e.projectedTopRight.y&&(e.projectedTopRight.y=t[n].y),t[n].y<e.projectedBottomLeft.y&&(e.projectedBottomLeft.y=t[n].y);e.topRight=o.Util.webMercatorToLatLng(new L.Point(e.projectedTopRight.x,e.projectedTopRight.y)),e.bottomLeft=o.Util.webMercatorToLatLng(new L.Point(e.projectedBottomLeft.x,e.projectedBottomLeft.y)),e.projectedBottomLeft=o.Util.webMercatorToLeaflet(e.projectedBottomLeft),e.projectedTopRight=o.Util.webMercatorToLeaflet(e.projectedTopRight),e.points=new Array,i.innerProjectedBoundaries.push(e);for(var r=0;r<t.length;r++)e.points.push(o.Util.webMercatorToLeaflet(t[r]));e.getProjectedBottomLeft=function(){var t=this;return new L.Point(t.projectedBottomLeft.x,t.projectedBottomLeft.y)},e.getProjectedTopRight=function(){var t=this;return new L.Point(t.projectedTopRight.x,t.projectedTopRight.y)}},i.getBoundingBox=function(){return new L.LatLngBounds(this._bottomLeft,this._topRight)},i.getProjectedBottomLeft=function(){return new L.Point(i.projectedBottomLeft.x,i.projectedBottomLeft.y)},i.getProjectedTopRight=function(){return new L.Point(i.projectedTopRight.x,i.projectedTopRight.y)},i.setBoundingBox=function(){var t=this;t.projectedBottomLeft=new L.Point(20026377,20048967),t.projectedTopRight=new L.Point(-20026377,-20048967);for(var e=this.outerBoundary.length-1;e>=0;e--)this.outerBoundary[e].x>t.projectedTopRight.x&&(t.projectedTopRight.x=this.outerBoundary[e].x),this.outerBoundary[e].x<t.projectedBottomLeft.x&&(t.projectedBottomLeft.x=this.outerBoundary[e].x),this.outerBoundary[e].y>t.projectedTopRight.y&&(t.projectedTopRight.y=this.outerBoundary[e].y),this.outerBoundary[e].y<t.projectedBottomLeft.y&&(t.projectedBottomLeft.y=this.outerBoundary[e].y);t.topRight=o.Util.webMercatorToLatLng(new L.Point(t.projectedTopRight.x,t.projectedTopRight.y)),t.bottomLeft=o.Util.webMercatorToLatLng(new L.Point(t.projectedBottomLeft.x,t.projectedBottomLeft.y)),t.projectedBottomLeft=o.Util.webMercatorToLeaflet(t.projectedBottomLeft),t.projectedTopRight=o.Util.webMercatorToLeaflet(t.projectedTopRight),t.centerPoint.lat=t.topRight.lat-t.bottomLeft.lat,t.centerPoint.lon=t.topRight.lon-t.bottomLeft.lon},i.getCenterPoint=function(){return i.centerPoint},i.getColor=function(){return i.color},i.setTravelTime=function(t){i.travelTime=t},i.getTravelTime=function(){return i.travelTime},i.setColor=function(t){i.color=t},i.setOpacity=function(t){i.opacity=t},i.getOpacity=function(){return i.opacity},i.setArea=function(t){i.area=t},i.getArea=function(){return i.area}},o.polygon=function(t,e,n){return new o.Polygon(t,e,n)},o.MultiPolygon=function(){var t=this;t._topRight=new L.latLng(-90,-180),t._bottomLeft=new L.latLng(90,180),t.travelTime,t.color,t.polygons=new Array,t.addPolygon=function(e){t.polygons.push(e)},t.setOpacity=function(e){t.opacity=e},t.getOpacity=function(){return t.opacity},t.setColor=function(e){t.color=e},t.getColor=function(){return t.color},t.getTravelTime=function(){return t.travelTime},t.setTravelTime=function(e){t.travelTime=e},t.getBoundingBox=function(){return new L.LatLngBounds(t._bottomLeft,t._topRight)},t.setBoundingBox=function(){_.each(t.polygons,function(e){e._topRight.lat>t._topRight.lat&&(t._topRight.lat=e._topRight.lat),e._bottomLeft.lat<t._bottomLeft.lat&&(t._bottomLeft.lat=e._bottomLeft.lat),e._topRight.lng>t._topRight.lng&&(t._topRight.lng=e._topRight.lng),e._bottomLeft.lng<t._bottomLeft.lng&&(t._bottomLeft.lng=e._bottomLeft.lng)})}},o.multiPolygon=function(){return new o.MultiPolygon},o.RouteSegment=function(t){var e=this;e.points=[],e.type=t.type,e.travelTime=t.travelTime,e.distance=t.length,e.warning=t.warning,e.elevationGain=t.elevationGain,e.errorMessage,e.transitSegment=!1,_.each(t.points,function(t){e.points.push(o.Util.webMercatorToLatLng(new L.Point(t[1],t[0]),t[2]))}),t.isTransit?(e.color=_.findWhere(o.config.routeTypes,{routeType:t.routeType}).color,e.transitSegment=!0,e.routeType=t.routeType,e.routeShortName=t.routeShortName,e.startname=t.startname,e.endname=t.endname,e.departureTime=t.departureTime,e.arrivalTime=t.arrivalTime,e.tripHeadSign=t.tripHeadSign):(e.color=_.findWhere(o.config.routeTypes,{routeType:t.type}).color,e.haloColor=_.findWhere(o.config.routeTypes,{routeType:t.type}).halo),e.getPoints=function(){return e.points},e.getType=function(){return e.type},e.getHaloColor=function(){return e.haloColor},e.getColor=function(){return e.color},e.getTravelTime=function(){return e.travelTime},e.getDistance=function(){return e.distance},e.getRouteType=function(){return e.routeType},e.getRouteShortName=function(){return e.routeShortName},e.getStartName=function(){return e.startname},e.getEndName=function(){return e.endname},e.getDepartureTime=function(){return e.departureTime},e.getArrivalTime=function(){return e.arrivalTime},e.getTripHeadSign=function(){return e.tripHeadSign},e.getWarning=function(){return e.warning},e.getElevationGain=function(){return e.elevationGain},e.isTransit=function(){return e.transitSegment}},o.routeSegment=function(t){return new o.RouteSegment(t)},o.Route=function(t,e){var n=this;n.travelTime=t,n.routeSegments=new Array,_.each(e,function(t){n.routeSegments.push(o.routeSegment(t))}),n.addRouteSegment=function(t){n.routeSegments.push(t)},n.setTravelTime=function(t){n.travelTime=t},n.getDistance=function(){for(var t=0,e=0;e<n.routeSegments.length;e++)t+=n.routeSegments[e].getDistance();return t},n.getElevationGain=function(){for(var t=0,e=0;e<n.routeSegments.length;e++)t+=n.routeSegments[e].getElevationGain();return t},n.getElevations=function(){for(var t={x:[],y:[]},e=0;e<1e3*n.getDistance();e+=100)t.x.push(e/1e3+" km"),t.y.push(n.getElevationAt(e));return t},n.getElevationAt=function(t){for(var e=0,o=n.getPoints(),i=1;i<o.length;i++){var r=o[i-1],a=o[i],s=r.distanceTo(a);if(e+=s,e>t)return a.alt}},n.getSegments=function(){return n.routeSegments},n.getPoints=function(){var t=[];return _.each(n.routeSegments,function(e){t=t.concat(e.getPoints())}),t},n.getTravelTime=function(){return n.travelTime},n.fadeIn=function(t,e,o,i,r){function a(e,o,n){var i={};i.color="undefined"!=typeof n&&_.has(n,"color")?n.color:e.getColor(),i.opacity=.8,i.weight=5,"TRANSIT"==e.getType()||"WALK"!=e.getType()&&"BIKE"!=e.getType()||(i.weight=7,i.dashArray="1, 10");var a={};a.weight=10,a.opacity=.7,a.color="undefined"!=typeof n&&_.has(n,"haloColor")?n.haloColor:"undefined"!=typeof e.getHaloColor()?e.getHaloColor():"#9D9D9D";var p=o/15,u=l(e.getPoints().reverse(),p),c=L.polyline(u[0],a).addTo(t),h=L.polyline(u[0],i).addTo(t);c.on("click",r),h.on("click",r),s(h,c,u,1)}function s(t,e,o,n){for(var i=t.getLatLngs(),r=0;r<o[n].length;r++)i.push(o[n][r]);0!=i.length&&(e.setLatLngs(i),t.setLatLngs(i)),++n<o.length&&setTimeout(function(){s(t,e,o,n)},15)}function l(t,e){for(var o,n,i=0,r=1/e,a=0,s=new Array,l=1;l<t.length;l++)i+=t[l-1].distanceTo(t[l]);for(var u=new Array,l=0;l<t.length-1;l++)if(u.push(t[l]),o=t[l].distanceTo(t[l+1]),n=o/i,a+=n,a>=r)for(;a>=r;)c=(r-(a-n))/n,u.push(p(t[l],t[l+1],c)),r+=1/e,s.push(u),u=new Array;return s.push(u),u=new Array,u.push(t[t.length-1]),s.push(u),s}function p(e,o,n){var i;i="undefined"!=typeof t.project?t:t._map;var r=i.project(e),a=i.project(o),s=(a.x-r.x)*n+r.x,l=(a.y-r.y)*n+r.y,p=new L.point(s,l),u=i.unproject(p);return u}var u,c,h,g,d=0;"undefined"==typeof e&&(e=0),"undefined"==typeof o&&(o="travelTime");for(var f=n.routeSegments.length-1;f>=0;f--){if(u=n.routeSegments[f],c="travelTime"==o?u.getTravelTime()/n.getTravelTime():u.getDistance()/n.getDistance(),h=c*e,"TRANSFER"!=u.getType())!function(t,e,o){setTimeout(function(){a(t,o,i)},e)}(u,d,h);else{var m=g.points[0],y=L.circleMarker(m,{color:"undefined"!=typeof i&&_.has(i,"color")?i.color:u.getColor(),fillColor:"undefined"!=typeof i&&_.has(i,"haloColor")?i.haloColor:"undefined"!=typeof u.getHaloColor()?u.getHaloColor():"#9D9D9D",fillOpacity:1,opacity:1,stroke:!0,weight:4,radius:7});!function(e,o){setTimeout(function(){e.addTo(t),e.bringToFront()},o)}(y,d)}d+=h,g=u}}},o.route=function(t,e){return new o.Route(t,e)},o.Route360PolygonLayer=L.Class.extend({initialize:function(t){this.opacity=o.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=o.config.defaultPolygonLayerOptions.strokeWidth,"undefined"!=typeof t&&("undefined"!=typeof t.opacity&&(this.opacity=t.opacity),"undefined"!=typeof t.strokeWidth&&(this.strokeWidth=t.strokeWidth)),this._multiPolygons=new Array,navigator.sayswho=function(){var t,e=navigator.userAgent,o=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(t[1]||"")):"Chrome"===o[1]&&(t=e.match(/\bOPR\/(\d+)/),null!=t)?"Opera "+t[1]:(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&o.splice(1,1,t[1]),o.join(" "))}()},getBoundingBox:function(){return new L.LatLngBounds(this._bottomLeft,this._topRight)},onAdd:function(t){this._map=t,this._el=L.DomUtil.create("div","my-custom-layer-"+$(t._container).attr("id")+" leaflet-zoom-hide"),$(this._el).attr("id","canvas"+$(this._map._container).attr("id")),this._map.getPanes().overlayPane.appendChild(this._el),this._map.on("moveend",this._reset,this),this._reset(!0)},clearAndAddLayers:function(t){this.clearLayers(),this.addLayer(t)},addLayer:function(t){var e=this;if(e.redrawCount=0,o.config.logging)var n=(new Date).getTime();if(e._resetBoundingBox(),e._multiPolygons=new Array,o.config.logging){(new Date).getTime()}for(var i=0;i<t.length;i++)for(var r=0;r<t[i].polygons.length;r++)t[i].polygons[r].project(),e._updateBoundingBox(t[i].polygons[r]),e._addPolygonToMultiPolygon(t[i].polygons[r]);if(e._multiPolygons.sort(function(t,e){return e.getTravelTime()-t.getTravelTime()}),o.config.logging){var a=(new Date).getTime();console.log("adding layers took "+(a-n))}e._reset()},_addPolygonToMultiPolygon:function(t){var e=_.filter(this._multiPolygons,function(e){return e.getTravelTime()==t.travelTime});if(e.length>0)e[0].addPolygon(t);else{var n=new o.multiPolygon;n.setTravelTime(t.travelTime),n.addPolygon(t),n.setColor(t.getColor()),n.setOpacity(t.getOpacity()),this._multiPolygons.push(n)}},_resetBoundingBox:function(){this._latlng=new L.LatLng(-180,90),this._topRight=new L.latLng(-90,-180),this._bottomLeft=new L.latLng(90,180)},addTo:function(t){return t.addLayer(this),this},_updateBoundingBox:function(t){var e=this;t.topRight.lat>e._topRight.lat&&(e._topRight.lat=t.topRight.lat),t.bottomLeft.lat<e._bottomLeft.lat&&(e._bottomLeft.lat=t.bottomLeft.lat),t.topRight.lng>e._topRight.lng&&(e._topRight.lng=t.topRight.lng),t.bottomLeft.lng<e._bottomLeft.lng&&(e._bottomLeft.lng=t.bottomLeft.lng),e._latlng.lat<e._topRight.lat&&(e._latlng.lat=e._topRight.lat),e._latlng.lng>e._bottomLeft.lng&&(e._latlng.lng=e._bottomLeft.lng)},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._el),t.off("viewreset",this._reset,this)},_buildPath:function(t,e){var o=new Array;return o.push(e),o.push(Math.round(t.x)),o.push(Math.round(t.y)),o},_clipToBounds:function(t,e){t.x>e.max.x?t.x=e.max.x:t.x<e.min.x&&(t.x=e.min.x),t.y>e.max.y?t.y=e.max.y:t.y<e.min.y&&(t.y=e.min.y)},_clip:function(t,e){var o,n,r,a,s=function(t){return(n[0]-o[0])*(t[1]-o[1])>(n[1]-o[1])*(t[0]-o[0])},l=function(){var t=[o[0]-n[0],o[1]-n[1]],e=[r[0]-a[0],r[1]-a[1]],i=o[0]*n[1]-o[1]*n[0],s=r[0]*a[1]-r[1]*a[0],l=1/(t[0]*e[1]-t[1]*e[0]);return[(i*e[0]-s*t[0])*l,(i*e[1]-s*t[1])*l]},p=t,o=e[e.length-1];for(j in e){var n=e[j],u=p;p=[],r=u[u.length-1];for(i in u){var a=u[i];s(a)?(s(r)||p.push(l()),p.push(a)):s(r)&&p.push(l()),r=a}o=n}return p},_scale:function(t,e){return t.x*=e,t.y*=e,t},_subtract:function(t,e,o){return t.x-=e,t.y-=o,o},_getMaxDiff:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},_splicePath:function(t){this._isCollinear()&&console.log,t.length>=3&&(t[t.length-1][1]==t[t.length-2][1]&&t[t.length-2][1]==t[t.length-3][1]?t.splice(t.length-2,1):t[t.length-1][2]==t[t.length-2][2]&&t[t.length-2][2]==t[t.length-3][2]&&t.splice(t.length-2,1))},_isCollinear:function(t,e,n){if(t.x==n.x&&t.y==n.y)return!1;if(t.x==e.x&&e.x==n.x)return!0;if(t.y==e.y&&e.y==n.y)return!0;var i=t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y);return i<o.config.defaultPolygonLayerOptions.tolerance&&i>-o.config.defaultPolygonLayerOptions.tolerance&&t.x!=n.x&&t.y!=n.y?!0:!1},_roundPoint:function(t){return t.x=Math.round(t.x),t.y=Math.round(t.y),t},_buildSVGPolygon:function(t,e,n,i){for(var r,a,s,l,p,u,c=this,h="M",g="L",d="z",f=0,m=[[n.min.x,n.min.y],[n.max.x,n.min.y],[n.max.x,n.max.y],[n.min.x,n.max.y]],y=new Array,v=0;v<e.length;v++)a=e[v],s=new L.Point(a.x,a.y),c._scale(s,i),c._roundPoint(s),r=v>0?c._getMaxDiff(p,s):o.config.defaultPolygonLayerOptions.tolerance,r>=o.config.defaultPolygonLayerOptions.tolerance&&(u=!1,f>2&&(u=c._isCollinear(l,p,s)),u?(y[y.length-1][0]=s.x,y[y.length-1][1]=s.y):(y.push([s.x,s.y]),l=p,p=s,f++));for(var T,b=this._clip(y,m),v=0;v<b.length;v++)a=b[v],s=new L.Point(a[0],a[1]),c._subtract(s,c._map.getPixelOrigin().x+c._offset.x,c._map.getPixelOrigin().y+c._offset.y),t.push(v>0?c._buildPath(s,g):c._buildPath(s,h)),T=s;return t.length>0&&t.push([d]),t},_createSVGData:function(t){var e=this,n=e._map.getPixelBounds(),i=(e._map.getSize(),Math.ceil(o.config.defaultPolygonLayerOptions.strokeWidth/2)),r=Math.ceil(o.config.defaultPolygonLayerOptions.strokeWidth/2);n.max.x+=i,n.min.x-=i,n.max.y+=r,n.min.y-=r;var a=256*Math.pow(2,e._map._zoom),s=new Array,l=t.getProjectedTopRight(),p=t.getProjectedBottomLeft();e._scale(l,a),e._scale(p,a),p.x>n.max.x||l.x<n.min.x||l.y>n.max.y||p.y<n.min.y||e._buildSVGPolygon(s,t.outerProjectedBoundary,n,a);for(var u=0;u<t.innerProjectedBoundaries.length;u++){e.runs++;var l=t.innerProjectedBoundaries[u].getProjectedTopRight(),p=t.innerProjectedBoundaries[u].getProjectedBottomLeft();e._scale(l,a),e._scale(p,a),p.x>n.max.x||l.x<n.min.x||l.y>n.max.y||p.y<n.min.y||e._buildSVGPolygon(s,t.innerProjectedBoundaries[u].points,n,a),e.counter++}return s},clearLayers:function(){$("#canvas"+$(this._map._container).attr("id")).empty(),this.initialize()},_reset:function(){var t=this,e=new Array;if(t.redrawCount++,o.config.logging)var n=(new Date).getTime();if(this._multiPolygons.length>0){var i,r,a=new L.Point(0,0);t._svgWidth=t._map.getSize().x,t._svgHeight=t._map.getSize().y,L.DomUtil.setPosition(this._el,a);var s=$("#svg_"+$(this._map._container).attr("id")),l=s.offset(),p=$(this._map._container).offset();"undefined"==typeof t._offset&&(t._offset=new L.Point(0,0)),"undefined"!=typeof l&&(t._offset.x+=p.left-l.left,t._offset.y+=p.top-l.top),$("#canvas"+$(this._map._container).attr("id")).empty();for(var u=0;u<this._multiPolygons.length;u++){if(r=this._multiPolygons[u],i=new Array,o.config.logging)var c=(new Date).getTime();for(var h=0;h<r.polygons.length;h++){var g=this._createSVGData(r.polygons[h]);i.push(g)}if(o.config.logging&&console.log("svg creation took: "+((new Date).getTime()-c)),0!=i.length){var d=r.getColor(),f=r.getOpacity();if(o.config.logging)var m=(new Date).getTime();var y=!1;t.redrawCount<=2&&o.config.defaultPolygonLayerOptions.animate&&t._isAnimated()&&(y=!0),e.push(o.config.defaultPolygonLayerOptions.inverse?t._getGElement(i,f,"black",y):t._getGElement(i,1,d,y)),o.config.logging&&console.log("raphael creation took: "+((new Date).getTime()-m)+"  svg path length: "+i.length)}}var v;v=o.config.defaultPolygonLayerOptions.inverse?t._getInverseSvgElement(e):t._getNormalSvgElement(e),$("#canvas"+$(this._map._container).attr("id")).append(v)}if(o.config.logging){var T=(new Date).getTime();console.log("layer resetting tool: "+(T-n)+"ms")}},_isAnimated:function(){return-1!=navigator.sayswho.indexOf("IE")?!1:-1!=navigator.sayswho.indexOf("Safari")?!1:-1!=navigator.sayswho.indexOf("Firefox")?!1:o.config.defaultPolygonLayerOptions.animate?!0:!1},_getFrame:function(t,e){var o=new Array;return o.push(["M",0,0]),o.push(["L",t,0]),o.push(["L",t,e]),o.push(["L",0,e]),o.push(["z"]),o},_getTranslation:function(){var t=this;return-1!=navigator.sayswho.indexOf("IE 9")?"transform:translate("+t._offset.x+"px,"+t._offset.y+"px)":-1!=navigator.sayswho.indexOf("Safari")?"-webkit-transform:translate3d("+t._offset.x+"px,"+t._offset.y+"px,0px)":-1!=navigator.sayswho.indexOf("Firefox")?"-moz-transform:translate3d("+t._offset.x+"px,"+t._offset.y+"px,0px)":"transform:translate3d("+t._offset.x+"px,"+t._offset.y+"px,0px)"},_getInverseSvgElement:function(t){for(var e=this,n=this._getFrame(e._svgWidth,e._svgHeight),i="<div id=svg_"+$(this._map._container).attr("id")+" style='"+e._getTranslation()+";''><svg height="+e._svgHeight+" width="+e._svgWidth+" style='fill:"+o.config.defaultPolygonLayerOptions.backgroundColor+" ; opacity: "+o.config.defaultPolygonLayerOptions.backgroundOpacity+"; stroke-width: "+o.config.defaultPolygonLayerOptions.strokeWidth+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",r="</svg></div>",a="",s=0;s<t.length;s++)a+=t[s];var l="<defs><mask id='mask_"+$(this._map._container).attr("id")+"'><path style='fill-opacity:1;stroke: white; fill:white;' d='"+n.toString().replace(/\,/g," ")+"'/>"+a+"</mask></defs>",p="<path style='mask: url(#mask_"+$(this._map._container).attr("id")+")'d='"+n.toString().replace(/\,/g," ")+"'/>";return i+p+l+r},_getGElement:function(t,e,n,i){var r=o.Util.generateId(),a=e,s=o.config.defaultPolygonLayerOptions.animationDuration;return i&&(a=0),"<g id="+r+" style='opacity:"+a+"'><path style='stroke: "+n+"; fill: "+n+" ; stroke-opacity: 1; stroke-width: "+o.config.defaultPolygonLayerOptions.strokeWidth+"; fill-opacity:1'd='"+t.toString().replace(/\,/g," ")+"'/></g><animate xlink:href='#"+r+"' attributeName='opacity' begin='0s' dur='"+s+"s' from="+a+" to="+e+" fill='freeze' />"},_getNormalSvgElement:function(t){for(var e=this,n="<div id=svg_"+$(this._map._container).attr("id")+" style='"+e._getTranslation()+";''><svg height="+e._svgHeight+" width="+e._svgWidth+" style='fill:"+o.config.defaultPolygonLayerOptions.backgroundColor+" ; opacity: "+o.config.defaultPolygonLayerOptions.opacity+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",i="</svg></div>",r="",a=0;a<t.length;a++)r+=t[a];return n+r+i}}),o.route360PolygonLayer=function(){return new o.Route360PolygonLayer}}(window,document);